<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indian Retail Sector: Investment Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Merriweather:ital,wght@0,300;0,700;1,300&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #334155;
        }

        h1, h2, h3, .serif {
            font-family: 'Merriweather', serif;
        }

        /* Chart Container Styling - Strict Constraints */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Prevent excessive width */
            height: 350px;    /* Base height */
            max-height: 400px;
            margin: 0 auto;   /* Center horizontally */
        }

        @media (max-width: 768px) {
            .chart-container {
                height: 280px;
                max-height: 300px;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Interactive Elements */
        .nav-item.active {
            background-color: #0f172a;
            color: white;
            font-weight: 600;
        }

        .sector-card {
            transition: all 0.3s ease;
        }
        .sector-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .metric-btn.active {
            border-bottom: 2px solid #0f172a;
            color: #0f172a;
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
    <!-- Chosen Palette: Professional Financial. Background: #f8fafc (Slate-50). Primary: #0f172a (Slate-900). Accent: #0ea5e9 (Sky-500) for growth, #e11d48 (Rose-600) for risks. -->
    <!-- Application Structure Plan: A 5-section dashboard. 1. Executive Summary (The 'Why Now'). 2. Sector Deep Dive (Interactive grid for Fashion/Grocery/Jewelry). 3. Financial Radar (Charts for SSSG, Margins, Valuation). 4. Competitive Moats (Store Economics). 5. Future Outlook (Timeline). The structure flows from broad market context to specific sector dynamics, then to hard financial data, ending with forward-looking strategy. -->
    <!-- Visualization & Content Choices: 
         - Doughnut Chart: Organized vs. Unorganized penetration (Goal: Context).
         - Interactive Cards: Sector segmentation (Goal: Inform).
         - Bar Charts: Rev/sqft comparison and Q-Commerce growth (Goal: Compare).
         - Line Chart: SSSG trends over 8 quarters (Goal: Trend).
         - Scatter Plot: Valuation vs Growth (Goal: Investment Strategy).
         - Timeline: Future outlook HTML visualization (Goal: Planning).
         Justification: Chart.js handles the data density well. HTML interactions allow users to drill down without clutter.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="flex flex-col min-h-screen">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 bg-slate-900 rounded flex items-center justify-center text-white font-bold serif">R</div>
                    <span class="text-xl font-bold text-slate-800 tracking-tight">Nemo's Compass <span class="text-slate-500 font-normal">DeepStratAI</span></span>
                </div>
                <!-- Desktop Nav -->
                <nav class="hidden md:flex space-x-1 bg-slate-100 p-1 rounded-lg">
                    <a href="/research/" class="text-sm font-bold text-slate-400 hover:text-slate-900 transition mr-6 flex items-center">
                    <span class="mr-1">‚Üê</span> Research - Back
                    </a>
                    <button onclick="navigate('summary')" class="nav-item active px-4 py-2 text-sm rounded-md transition-colors">Summary</button>
                    <button onclick="navigate('sectors')" class="nav-item px-4 py-2 text-sm text-slate-600 hover:text-slate-900 rounded-md transition-colors">Sectors</button>
                    <button onclick="navigate('financials')" class="nav-item px-4 py-2 text-sm text-slate-600 hover:text-slate-900 rounded-md transition-colors">Financials</button>
                    <button onclick="navigate('outlook')" class="nav-item px-4 py-2 text-sm text-slate-600 hover:text-slate-900 rounded-md transition-colors">Outlook</button>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">

        <!-- SECTION 1: EXECUTIVE SUMMARY -->
        <section id="summary" class="animate-fade-in space-y-8">
            <div class="text-center max-w-3xl mx-auto mb-12">
                <h1 class="text-3xl md:text-4xl font-bold text-slate-900 serif mb-4">The Great Indian Consumption Story</h1>
                <p class="text-lg text-slate-600 leading-relaxed">
                    A deep dive into the structural shift from unorganized to organized retail, the "K-Shaped" recovery driving premiumization, and the disruptive force of Quick Commerce.
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Market Structure Chart -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100 flex flex-col">
                    <h3 class="text-lg font-bold text-slate-800 mb-2">Retail Penetration</h3>
                    <p class="text-sm text-slate-500 mb-4">Organized retail is rapidly gaining share from traditional Kirana stores.</p>
                    <div class="chart-container flex-grow">
                        <canvas id="marketShareChart"></canvas>
                    </div>
                </div>

                <!-- Key Themes Grid -->
                <div class="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-indigo-50 p-6 rounded-xl border border-indigo-100">
                        <h4 class="text-indigo-900 font-bold text-lg mb-2">‚ö° The "Q-Commerce" Effect</h4>
                        <p class="text-indigo-800 text-sm mb-3">Platforms like Blinkit and Zepto are disrupting the "top-up" grocery segment.</p>
                        <div class="text-2xl font-bold text-indigo-900">70-80% YoY</div>
                        <div class="text-xs text-indigo-700">Growth Rate of Q-Comm vs 15% for Modern Trade</div>
                    </div>

                    <div class="bg-amber-50 p-6 rounded-xl border border-amber-100">
                        <h4 class="text-amber-900 font-bold text-lg mb-2">üíé Premiumization</h4>
                        <p class="text-amber-800 text-sm mb-3">Discretionary spending is skewing towards luxury and premium goods.</p>
                        <div class="text-2xl font-bold text-amber-900">Titan & Trent</div>
                        <div class="text-xs text-amber-700">Outperforming mass-market peers</div>
                    </div>

                    <div class="bg-emerald-50 p-6 rounded-xl border border-emerald-100">
                        <h4 class="text-emerald-900 font-bold text-lg mb-2">üè≠ Private Label Power</h4>
                        <p class="text-emerald-800 text-sm mb-3">Retailers owning their brands command superior gross margins.</p>
                        <div class="text-2xl font-bold text-emerald-900">~50-60%</div>
                        <div class="text-xs text-emerald-700">Gross Margins for Trent (Zudio/Westside)</div>
                    </div>

                    <div class="bg-rose-50 p-6 rounded-xl border border-rose-100">
                        <h4 class="text-rose-900 font-bold text-lg mb-2">‚ö†Ô∏è Valuation Risk</h4>
                        <p class="text-rose-800 text-sm mb-3">Sector trades at a significant premium to historical averages.</p>
                        <div class="text-2xl font-bold text-rose-900">80x+ P/E</div>
                        <div class="text-xs text-rose-700">Average Sector Multiple</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 2: SECTOR DEEP DIVE -->
        <section id="sectors" class="hidden animate-fade-in space-y-6">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-slate-900 serif">Sector Deep Dive & Competitive Landscape</h2>
                <p class="text-slate-600 mt-2">Explore the nuances of Fashion, Grocery, Jewelry, and Electronics. Click a card to reveal specific investment insights.</p>
            </div>

            <!-- Sector Toggles -->
            <div class="flex overflow-x-auto space-x-4 pb-4">
                <button onclick="showSector('fashion')" class="sector-toggle active min-w-[120px] px-4 py-3 rounded-lg bg-white border border-slate-200 shadow-sm text-center hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-slate-900 transition-all">
                    <div class="text-2xl mb-1">üëó</div>
                    <div class="font-semibold text-sm">Fashion</div>
                </button>
                <button onclick="showSector('grocery')" class="sector-toggle min-w-[120px] px-4 py-3 rounded-lg bg-white border border-slate-200 shadow-sm text-center hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-slate-900 transition-all">
                    <div class="text-2xl mb-1">üõí</div>
                    <div class="font-semibold text-sm">Grocery</div>
                </button>
                <button onclick="showSector('jewelry')" class="sector-toggle min-w-[120px] px-4 py-3 rounded-lg bg-white border border-slate-200 shadow-sm text-center hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-slate-900 transition-all">
                    <div class="text-2xl mb-1">üíç</div>
                    <div class="font-semibold text-sm">Jewelry</div>
                </button>
                <button onclick="showSector('electronics')" class="sector-toggle min-w-[120px] px-4 py-3 rounded-lg bg-white border border-slate-200 shadow-sm text-center hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-slate-900 transition-all">
                    <div class="text-2xl mb-1">üì±</div>
                    <div class="font-semibold text-sm">Electronics</div>
                </button>
            </div>

            <!-- Dynamic Content Area -->
            <div id="sector-content" class="bg-white p-8 rounded-2xl shadow-sm border border-slate-200">
                <!-- Content injected via JS -->
            </div>
        </section>

        <!-- SECTION 3: FINANCIALS & MOATS -->
        <section id="financials" class="hidden animate-fade-in space-y-8">
            <div class="flex flex-col md:flex-row justify-between items-end border-b border-slate-200 pb-4">
                <div>
                    <h2 class="text-2xl font-bold text-slate-900 serif">Financial Health & Moats</h2>
                    <p class="text-slate-600 mt-2">Analyzing the "Holy Grail" of retail: Same Store Sales Growth (SSSG) and Store Economics.</p>
                </div>
                <div class="flex space-x-4 mt-4 md:mt-0">
                    <button onclick="updateFinanceChart('sssg')" class="metric-btn active pb-2 text-sm font-medium text-slate-900 transition-colors">SSSG Trends</button>
                    <button onclick="updateFinanceChart('efficiency')" class="metric-btn pb-2 text-sm font-medium text-slate-500 hover:text-slate-900 transition-colors">Revenue/Sq.Ft</button>
                    <button onclick="updateFinanceChart('valuation')" class="metric-btn pb-2 text-sm font-medium text-slate-500 hover:text-slate-900 transition-colors">Valuation Map</button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Main Chart -->
                <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                    <div class="chart-container">
                        <canvas id="financialChart"></canvas>
                    </div>
                    <div id="chart-context" class="mt-4 p-4 bg-slate-50 rounded-lg text-sm text-slate-700">
                        <!-- Context text updated via JS -->
                    </div>
                </div>

                <!-- Metrics Sidebar -->
                <div class="space-y-6">
                    <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                        <h4 class="font-bold text-slate-800 mb-3">üèÜ Store Economics Leader</h4>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-slate-600">DMart</span>
                            <span class="font-bold text-green-600">‚Çπ31,000 / sq.ft</span>
                        </div>
                        <div class="w-full bg-slate-100 h-2 rounded-full">
                            <div class="bg-green-500 h-2 rounded-full" style="width: 95%"></div>
                        </div>
                        <p class="text-xs text-slate-500 mt-2">Highest asset turnover in the industry.</p>
                    </div>

                    <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                        <h4 class="font-bold text-slate-800 mb-3">üìâ Working Capital Cycle</h4>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-slate-600">Trent (Zudio)</span>
                            <span class="font-bold text-slate-900">Negative WC</span>
                        </div>
                        <p class="text-xs text-slate-500">Sells inventory faster than it pays suppliers, generating free float.</p>
                    </div>

                    <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                        <h4 class="font-bold text-slate-800 mb-3">üöÄ Fastest Expansion</h4>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-slate-600">Kalyan Jewelers</span>
                            <span class="font-bold text-blue-600">35% YoY</span>
                        </div>
                        <p class="text-xs text-slate-500">Aggressive franchising model (FOCO).</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 4: OUTLOOK -->
        <section id="outlook" class="hidden animate-fade-in space-y-8">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-slate-900 serif">Strategic Outlook & Investment Thesis</h2>
                <p class="text-slate-600 mt-2">Navigating the timeline from short-term rural recovery to long-term tier-2/3 saturation.</p>
            </div>

            <!-- Strategy Matrix -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
                <div class="bg-slate-900 text-white p-8 rounded-2xl relative overflow-hidden group hover:shadow-2xl transition-all">
                    <div class="absolute top-0 right-0 p-8 opacity-10 text-9xl font-serif">C</div>
                    <h3 class="text-2xl font-bold mb-4 z-10 relative">The Compounders</h3>
                    <p class="text-slate-300 mb-6 relative z-10">Companies with established moats, high RoCE, and a long runway for store expansion.</p>
                    <ul class="space-y-3 relative z-10">
                        <li class="flex items-center"><span class="w-2 h-2 bg-green-400 rounded-full mr-3"></span><strong>Trent:</strong> Best-in-class execution with Zudio.</li>
                        <li class="flex items-center"><span class="w-2 h-2 bg-green-400 rounded-full mr-3"></span><strong>Titan:</strong> Unchallenged in Jewelry trust.</li>
                        <li class="flex items-center"><span class="w-2 h-2 bg-green-400 rounded-full mr-3"></span><strong>DMart:</strong> Cost leadership in Grocery.</li>
                    </ul>
                </div>

                <div class="bg-white p-8 rounded-2xl border border-slate-200 relative overflow-hidden group hover:shadow-xl transition-all">
                    <div class="absolute top-0 right-0 p-8 opacity-5 text-9xl font-serif text-slate-900">D</div>
                    <h3 class="text-2xl font-bold text-slate-900 mb-4">The Risks & Disruptors</h3>
                    <p class="text-slate-600 mb-6">Headwinds that could derail the investment thesis.</p>
                    <ul class="space-y-3">
                        <li class="flex items-center"><span class="w-2 h-2 bg-red-500 rounded-full mr-3"></span><strong>Valuation:</strong> Pricing in perfection (80x+ PE).</li>
                        <li class="flex items-center"><span class="w-2 h-2 bg-red-500 rounded-full mr-3"></span><strong>Q-Commerce:</strong> Eating into monthly grocery baskets.</li>
                        <li class="flex items-center"><span class="w-2 h-2 bg-red-500 rounded-full mr-3"></span><strong>Competition:</strong> "Me-too" fast fashion brands eroding margins.</li>
                    </ul>
                </div>
            </div>

            <!-- Timeline -->
            <div class="bg-white p-6 rounded-xl border border-slate-200">
                <h3 class="font-bold text-lg text-slate-800 mb-6">Analyst Timeline</h3>
                <div class="relative">
                    <div class="absolute left-4 top-0 h-full w-0.5 bg-slate-200"></div>
                    
                    <div class="relative pl-12 pb-8">
                        <div class="absolute left-[9px] top-1.5 w-4 h-4 rounded-full bg-blue-500 border-4 border-white shadow-sm"></div>
                        <h4 class="font-bold text-slate-900">Short Term (1-2 Years)</h4>
                        <p class="text-sm text-slate-600 mt-1">Rural demand recovery post-monsoon. Mass consumption bottoms out. Q-Commerce consolidates in metros.</p>
                    </div>

                    <div class="relative pl-12 pb-8">
                        <div class="absolute left-[9px] top-1.5 w-4 h-4 rounded-full bg-slate-400 border-4 border-white shadow-sm"></div>
                        <h4 class="font-bold text-slate-900">Mid Term (3-5 Years)</h4>
                        <p class="text-sm text-slate-600 mt-1">Formalization of Jewelry (Titan/Kalyan) peaks. Footwear and Innerwear consolidation. Supply chain efficiencies drive margin expansion.</p>
                    </div>

                    <div class="relative pl-12">
                        <div class="absolute left-[9px] top-1.5 w-4 h-4 rounded-full bg-slate-300 border-4 border-white shadow-sm"></div>
                        <h4 class="font-bold text-slate-900">Long Term (5+ Years)</h4>
                        <p class="text-sm text-slate-600 mt-1">Saturation of Tier 1. Profitability depends on Tier 2/3 economics. Omni-channel becomes the standard operating model.</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-slate-50 border-t border-slate-200 py-8 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center text-slate-500 text-sm">
            <p class="font-medium text-slate-700">Investment Research Prototype</p>
            <p class="mt-2">Data sources: Retailers Association of India (RAI), Quarterly Earnings Reports, Industry Analysis.</p>
            <p>Generated for educational purposes.</p>
        </div>
    </footer>

    <script>
        // State Management
        const appState = {
            currentSection: 'summary',
            currentSector: 'fashion',
            currentChartType: 'sssg'
        };

        // Navigation Logic
        function navigate(sectionId) {
            // Update State
            appState.currentSection = sectionId;

            // UI Updates - Hide all sections
            ['summary', 'sectors', 'financials', 'outlook'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.remove('hidden');

            // Update Nav Buttons
            document.querySelectorAll('.nav-item').forEach(btn => {
                btn.classList.remove('active', 'bg-slate-900', 'text-white');
                btn.classList.add('text-slate-600', 'hover:text-slate-900');
                if(btn.getAttribute('onclick').includes(sectionId)) {
                    btn.classList.add('active', 'bg-slate-900', 'text-white');
                    btn.classList.remove('text-slate-600', 'hover:text-slate-900');
                }
            });

            // Initialize specific section logic
            if(sectionId === 'sectors') showSector(appState.currentSector);
            if(sectionId === 'financials') updateFinanceChart(appState.currentChartType);
        }

        // --- SECTOR DEEP DIVE LOGIC ---
        const sectorData = {
            fashion: {
                title: "Fashion & Apparel",
                color: "bg-purple-50 border-purple-100 text-purple-900",
                icon: "üëó",
                stats: [
                    { label: "Top Pick", value: "Trent (Zudio)" },
                    { label: "Key Trend", value: "Fast Fashion" },
                    { label: "Risk", value: "Competition" }
                ],
                content: "Trent has disrupted the market with Zudio's aggressive pricing (<‚Çπ999) and rapid inventory turnover (Private Label 100%). ABFRL is struggling with debt and integration of acquired D2C brands. Page Industries (Jockey) faces headwinds from sluggish rural demand."
            },
            grocery: {
                title: "Grocery & Food",
                color: "bg-green-50 border-green-100 text-green-900",
                icon: "üõí",
                stats: [
                    { label: "Top Pick", value: "DMart" },
                    { label: "Disruptor", value: "Blinkit/Zepto" },
                    { label: "Risk", value: "Q-Commerce" }
                ],
                content: "DMart remains the cost leader with ownership of assets ensuring high EBITDA margins. However, Q-Commerce players (Blinkit) are eating into the high-margin 'impulse' and 'top-up' categories in metros, forcing traditional modern trade to rethink strategy."
            },
            jewelry: {
                title: "Jewelry & Gems",
                color: "bg-amber-50 border-amber-100 text-amber-900",
                icon: "üíç",
                stats: [
                    { label: "Top Pick", value: "Titan" },
                    { label: "Driver", value: "Formalization" },
                    { label: "Growth", value: "20% CAGR" }
                ],
                content: "The most attractive segment due to the 'Wedding' tailwind and shift from unorganized family jewelers to trusted brands like Tanishq (Titan) and Kalyan. Titan commands a significant P/E premium due to its consistent compounding history."
            },
            electronics: {
                title: "Consumer Electronics",
                color: "bg-blue-50 border-blue-100 text-blue-900",
                icon: "üì±",
                stats: [
                    { label: "Player", value: "Electronics Mart" },
                    { label: "Theme", value: "Premiumization" },
                    { label: "Trend", value: "Zero Cost EMI" }
                ],
                content: "Demand for premium phones and large appliances is robust. Electronics Mart is expanding regionally. The availability of easy finance (Bajaj Finance) is a massive enabler for ticket-size growth."
            }
        };

        function showSector(sectorKey) {
            appState.currentSector = sectorKey;
            
            // Update Buttons
            document.querySelectorAll('.sector-toggle').forEach(btn => {
                btn.classList.remove('active', 'border-slate-900', 'ring-2', 'ring-slate-900');
                if(btn.getAttribute('onclick').includes(sectorKey)) {
                    btn.classList.add('active', 'border-slate-900', 'ring-2', 'ring-slate-900');
                }
            });

            // Update Content
            const data = sectorData[sectorKey];
            const contentDiv = document.getElementById('sector-content');
            
            contentDiv.innerHTML = `
                <div class="flex flex-col md:flex-row gap-6 animate-fade-in">
                    <div class="md:w-1/3">
                        <div class="${data.color} p-6 rounded-xl border mb-4">
                            <div class="text-4xl mb-4">${data.icon}</div>
                            <h3 class="text-xl font-bold mb-1">${data.title}</h3>
                            <div class="space-y-3 mt-4">
                                ${data.stats.map(s => `
                                    <div class="flex justify-between text-sm border-b border-black/10 pb-2">
                                        <span class="opacity-70">${s.label}</span>
                                        <span class="font-bold">${s.value}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    <div class="md:w-2/3">
                        <h4 class="text-lg font-bold text-slate-800 mb-3">Analyst Commentary</h4>
                        <p class="text-slate-600 leading-relaxed mb-6">${data.content}</p>
                        
                        <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                            <h5 class="font-bold text-xs uppercase tracking-wide text-slate-500 mb-2">Key Competitors</h5>
                            <div class="flex flex-wrap gap-2">
                                ${getCompetitors(sectorKey)}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function getCompetitors(sector) {
            const comps = {
                fashion: ['Trent', 'ABFRL', 'Page Industries', 'V-Mart'],
                grocery: ['DMart', 'Reliance Retail', 'Spencer\'s'],
                jewelry: ['Titan', 'Kalyan', 'Senco'],
                electronics: ['Electronics Mart', 'Croma (Tata)', 'Reliance Digital']
            };
            return comps[sector].map(c => `<span class="px-3 py-1 bg-white border border-slate-200 rounded-full text-sm font-medium text-slate-700 shadow-sm">${c}</span>`).join('');
        }


        // --- CHARTS ---
        let marketShareChart = null;
        let financialChart = null;

        document.addEventListener('DOMContentLoaded', () => {
            initMarketShareChart();
        });

        function initMarketShareChart() {
            const ctx = document.getElementById('marketShareChart').getContext('2d');
            marketShareChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Unorganized (Kirana/Local)', 'Organized (Modern Trade)', 'E-Commerce'],
                    datasets: [{
                        data: [82, 12, 6],
                        backgroundColor: ['#e2e8f0', '#0f172a', '#3b82f6'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: { position: 'bottom', labels: { usePointStyle: true, font: { family: 'Inter', size: 11 } } },
                        tooltip: { callbacks: { label: (c) => ` ${c.label}: ${c.raw}%` } }
                    }
                }
            });
        }

        function updateFinanceChart(type) {
            appState.currentChartType = type;
            const ctx = document.getElementById('financialChart').getContext('2d');
            const contextText = document.getElementById('chart-context');
            
            // Update buttons
            document.querySelectorAll('.metric-btn').forEach(btn => {
                btn.classList.remove('active', 'text-slate-900', 'border-slate-900');
                btn.classList.add('text-slate-500');
                if(btn.getAttribute('onclick').includes(type)) {
                    btn.classList.add('active', 'text-slate-900', 'border-slate-900');
                    btn.classList.remove('text-slate-500');
                }
            });

            if (financialChart) financialChart.destroy();

            if (type === 'sssg') {
                contextText.innerHTML = "<strong>Insight:</strong> Trent (Zudio/Westside) consistently delivers >10% SSSG, defying the broader slowdown. ABFRL struggles with single-digit growth.";
                financialChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Q1FY23', 'Q2FY23', 'Q3FY23', 'Q4FY23', 'Q1FY24', 'Q2FY24', 'Q3FY24', 'Q4FY24'],
                        datasets: [
                            { label: 'Trent', data: [18, 22, 15, 12, 14, 16, 12, 15], borderColor: '#10b981', tension: 0.3 },
                            { label: 'DMart', data: [25, 18, 8, 6, 5, 4, 6, 7], borderColor: '#3b82f6', tension: 0.3 },
                            { label: 'ABFRL', data: [15, 12, 5, -2, -1, 2, 1, 3], borderColor: '#ef4444', tension: 0.3 }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: { mode: 'index', intersect: false },
                        plugins: { legend: { position: 'top' } },
                        scales: { y: { title: { display: true, text: 'SSSG Growth (%)' } } }
                    }
                });
            } else if (type === 'efficiency') {
                contextText.innerHTML = "<strong>Insight:</strong> DMart is the undisputed king of asset turnover. Apparel players generally operate at lower density.";
                financialChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['DMart', 'Trent', 'Titan', 'V-Mart', 'Shoppers Stop'],
                        datasets: [{
                            label: 'Revenue per Sq. Ft (INR)',
                            data: [31000, 12500, 28000, 8500, 9200],
                            backgroundColor: ['#0f172a', '#10b981', '#f59e0b', '#94a3b8', '#94a3b8'],
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { y: { beginAtZero: true } }
                    }
                });
            } else if (type === 'valuation') {
                contextText.innerHTML = "<strong>Insight:</strong> High growth commands high multiples. Trent trades at a premium due to scarcity of high-growth consumption plays.";
                financialChart = new Chart(ctx, {
                    type: 'bubble',
                    data: {
                        datasets: [{
                            label: 'Retailers',
                            data: [
                                { x: 35, y: 110, r: 20, label: 'Trent' }, // High Growth, High PE
                                { x: 18, y: 90, r: 18, label: 'DMart' },
                                { x: 20, y: 85, r: 25, label: 'Titan' },
                                { x: 12, y: 45, r: 15, label: 'ABFRL' },
                                { x: 8, y: 35, r: 10, label: 'V-Mart' }
                            ],
                            backgroundColor: (c) => {
                                const val = c.raw?.x;
                                return val > 20 ? '#10b981' : val > 15 ? '#f59e0b' : '#ef4444';
                            }
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: { title: { display: true, text: 'Earnings Growth CAGR (%)' }, min: 0, max: 40 },
                            y: { title: { display: true, text: 'P/E Ratio (x)' }, min: 20, max: 130 }
                        },
                        plugins: {
                            tooltip: { callbacks: { label: (c) => `${c.raw.label}: ${c.raw.x}% Growth @ ${c.raw.y}x P/E` } },
                            legend: { display: false }
                        }
                    }
                });
            }
        }
    </script>
</body>
</html>